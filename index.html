<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Ñ–∏–∫–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Ñ–∏–∫–æ–≤</h1>

  <form id="ficForm">
    <label>
      –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏
      <select name="relationshipSize">
        <option value="1">1 (—Å–æ–ª–æ)</option>
        <option value="2" selected>2 (–∫–ª–∞—Å—Å–∏–∫–∞)</option>
        <option value="3">3 (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–æ–π–Ω–∏—á–∫–∞)</option>
      </select>
    </label>
    <br>

    <label>
      –¢–∏–ø:
      <select name="type">
        <option value="slash">–°–ª–µ—à</option>
        <option value="femslash">–§–µ–º—Å–ª–µ—à</option>
        <option value="gen">–î–∂–µ–Ω</option>
      </select>
    </label>
    <br>

    <label>
      –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ (0-5)
      <input type="number" name="sideCount" min="0" max="5" value="2">
    </label>
    <br>

    <label>
      NSFW
      <input type="checkbox" name="nsfw">
    </label>
    <br>

    <button type="submit">–ì–æ</button>
  </form>

  <div id="result"></div>

  <script>
    let characters = [];
    let genres = [];
    let settings = [];
    let kinks = [];
    let situations = [];
    let tropes = [];
    let ficKeywords = [];
    
    Promise.all([
      fetch('assets/bleach/characters.json').then(r => r.json()),
      fetch('assets/genres.json').then(r => r.json()),
      fetch('assets/bleach/settings.json').then(r => r.json()),
      fetch('assets/kinks.json').then(r => r.json()),
      fetch('assets/bleach/situations.json').then(r => r.json()),
      fetch('assets/tropes.json').then(r => r.json()),
      fetch('assets/keywords.json').then(r => r.json())
    ]).then(([charData, genreData, settingData, kinkData, situationData, tropeData, keywordData]) => {
      characters = charData;
      genres = genreData;
      settings = settingData;
      kinks = kinkData;
      situations = situationData;
      tropes = tropeData;
      ficKeywords = keywordData;
    }).catch(error => {
      console.error('Error loading data:', error);
    });

    function getRandom(arr, count = 1) {
      const copy = [...arr];
      const picks = [];
      while (count-- && copy.length) {
        const i = Math.floor(Math.random() * copy.length);
        picks.push(copy.splice(i, 1)[0]);
      }
      return picks;
    }
  
    function getEmoji() {
      const emojis = ['‚ù§Ô∏è', '‚ú®', '‚öîÔ∏è', '‚ùÑÔ∏è', 'üî•', '‚ö°Ô∏è', '‚ò†Ô∏è', 'üçì', 'üåô', 'üíÄ', 'ü©∏', 'üå∏', 'üïäÔ∏è', 'üß®', 'üîÆ'];
      return emojis[Math.floor(Math.random() * emojis.length)];
    }
  
    document.getElementById('ficForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = new FormData(e.target);
  
      const data = {
        relationshipSize: parseInt(form.get('relationshipSize')) || 1,
        type: form.get('type') || 'gen',
        sideCount: parseInt(form.get('sideCount')) || 0,
        nsfw: form.get('nsfw') === 'on'
      };
  
      let genderFilter = () => true;
      if (data.type === 'slash') genderFilter = c => c.gender === 'male';
      if (data.type === 'femslash') genderFilter = c => c.gender === 'female';
  
      const filteredChars = characters.filter(genderFilter);
      const mainRelationship = getRandom(filteredChars, data.relationshipSize);
  
      const usedNames = new Set(mainRelationship.map(c => c.name));
      const remainingChars = characters.filter(c => !usedNames.has(c.name));
      const sideCharacters = getRandom(remainingChars, data.sideCount);
  
      const genre = getRandom(genres)[0];
      const setting = getRandom(settings)[0];
      const situation = getRandom(situations)[0];
      const trope = getRandom(tropes)[0];
      const kink = data.nsfw ? getRandom(kinks)[0] : null;
      const keywords = getRandom(ficKeywords, 3);
  
      const resultDiv = document.getElementById('result');

      resultDiv.innerHTML = `
        <div class="relationship">
          ${mainRelationship.map(c => `
            <div class="char">
              <img src="${c.image}" alt="${c.name}" class="char-icon">
              <p>${c.name}</p>
            </div>
          `).join(`<span>${getEmoji()}</span>`)}
        </div>  

        <p class='keywords'>¬´  ${keywords.join(' ‚Ä¢ ')}  ¬ª</p>

        <div class='info-block'>
          <div class='info-row'>
            <div class='info-label'>–ñ–∞–Ω—Ä</div>
            <div class='info-value'>${genre.name}<br><span class="info-description">${genre.description}</span></div>
          </div>
          <div class="info-row">
            <div class="info-label">–°–µ—Ç—Ç–∏–Ω–≥</div>
            <div class='info-value'>${setting.name}</div>
          </div>
          <div class="info-row">
            <div class="info-label">–°–∏—Ç—É–∞—Ü–∏—è</div>
            <div class='info-value'>${situation.name}</div>
          </div>
          <div class="info-row">
            <div class="info-label">–¢—Ä–æ–ø</div>
            <div class='info-value'>${trope.name}<br><span class="info-description">${trope.description}</span></div>
          </div>
          ${kink ? `
            <div class="info-row">
              <div class="info-label">–ö–∏–Ω–∫</div>
              <div class='info-value'>${kink.name}<br><span class="info-description">${kink.description}</span></div>
            </div>
          ` : ''}
        </div>
  
        ${sideCharacters.length > 0 ? `
          <h3>–í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
            <div class="side-chars">
              ${sideCharacters.map(c => `
                <div class="char">
                  <img src="${c.image}" alt="${c.name}" class="char-icon">
                  <p>${c.name}</p>
                </div>
              `).join('')}
            </div>
        ` : ''}
      `;
    });
  </script>
</body>
</html>
